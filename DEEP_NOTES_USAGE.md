# 深度笔记功能使用说明

## 🎯 功能概述

本系统现在默认生成**中文深度笔记**，无论输入视频的语言是什么，都会输出高质量的中文分析。

## ✨ 功能特性

### 🔥 主要特性
- **默认深度模式**：系统默认使用 `detailed` 风格，生成深度笔记
- **强制中文输出**：无论视频是英文、日文等任何语言，笔记都是中文
- **三层分析结构**：内容概要 → 关键洞察 → 应用思考
- **基于highlights的时间轴**：AI重点生成高质量highlights，自动转换为时间轴
- **统一时间线逻辑**：时间轴目录直接使用highlights内容，确保一致性
- **专用Markdown文件**：生成独立的深度笔记文件

### 📁 生成文件
1. `summary.json` - 包含高质量highlights、自动生成的timeline和deepNotes字段
2. `summary.txt` - 传统的可读摘要
3. `[视频标题].md` - **新增**深度笔记Markdown文件（时间轴目录使用highlights内容）

## 🚀 使用方法

### 方法1: 使用测试脚本验证提示词效果

```bash
# 设置API密钥
export OPENAI_API_KEY="your-api-key-here"

# 运行测试脚本
node test-prompt.js
```

测试脚本会：
- 使用现有的史蒂夫·乔布斯演讲转录数据
- 调用新的深度笔记提示词
- 生成中文深度笔记
- 保存结果到 `test-output/` 目录

### 方法2: 通过API处理新视频

```bash
# 启动服务器
npm run dev

# 处理YouTube视频
curl -X POST http://localhost:3000/api/tasks \\
  -H "Content-Type: application/json" \\
  -d '{
    "link": "https://www.youtube.com/watch?v=UF8uR6Z6KLc",
    "options": {
      "language": "Chinese",
      "style": "detailed"
    }
  }'
```

## 📝 生成的深度笔记格式

### JSON结构
```json
{
  "summary": "主要内容概述（中文）",
  "highlights": [
    {"start": 0, "end": 105, "note": "开场和核心主题介绍：乔布斯分享三个人生故事的框架"},
    {"start": 105, "end": 210, "note": "第一个故事-连接人生的点：从辍学到学习书法，最终影响Mac设计"},
    {"start": 210, "end": 315, "note": "第二个故事-爱与失落：创立苹果、被解雇、重新开始的人生转折"}
  ],
  "topics": ["主题1（中文）", "主题2（中文）"],
  "keyPoints": ["要点1（中文）", "要点2（中文）"],
  "conclusion": "总结（中文）",
  "timeline": [
    {"start": "00:00", "end": "01:45", "title": "开场和核心主题介绍：乔布斯分享三个人生故事的框架"},
    {"start": "01:45", "end": "03:30", "title": "第一个故事-连接人生的点：从辍学到学习书法，最终影响Mac设计"}
  ],
  "deepNotes": "# 深度笔记\\n\\n## 内容概要\\n[概述]\\n\\n## 关键洞察\\n[分析]\\n\\n## 应用思考\\n[思考]"
}
```

**重要说明**：`timeline` 字段现在自动从 `highlights` 生成，AI不需要单独提供timeline字段。

### Markdown文件结构
```markdown
# 视频标题

## 原视频标题
Steve Jobs Stanford演讲

## 时间轴目录
- **00:00-01:45**: 开场和核心主题介绍：乔布斯分享三个人生故事的框架
- **01:45-03:30**: 第一个故事-连接人生的点：从辍学到学习书法，最终影响Mac设计
- **03:30-05:15**: 第二个故事-爱与失落：创立苹果、被解雇、重新开始的人生转折

*注意：时间轴目录现在直接来自highlights字段，内容更加精准和有意义*

# 深度笔记

## 内容概要
[用2-3段话概述视频的整体内容和核心主题]

## 关键洞察
### 核心观点1
[深入分析第一个重要观点，包括背景、论证过程、实例]

### 核心观点2  
[深入分析第二个重要观点，挖掘深层含义]

## 应用思考
### 实践启发
[如何将这些观点应用到实际生活或工作中]

### 深度思考
[引发的更深层思考和哲学思辨]

### 行动建议
[具体的行动建议和实施路径]
```

## ⚙️ 系统配置

### 默认设置
- **语言**: `Chinese` (默认中文输出)
- **风格**: `detailed` (唯一支持的风格)
- **Token限制**: 10,000 tokens (确保高质量输出)
- **温度**: 0.3 (平衡创意和准确性)

### Timeline Helper
新增的 `timeline-helper.ts` 工具提供：
- 智能分段（1-2分钟每段）
- 自然断点检测
- 后备标题生成
- 多语言断点识别

## 🧪 测试和验证

### 提示词测试
运行 `test-prompt.js` 可以：
- 验证中文输出质量
- 检查时间轴分段效果
- 测试深度笔记结构
- 确认Markdown格式正确性

### 预期结果
- ✅ 所有输出字段都是中文
- ✅ 时间轴分段合理（3-8段）
- ✅ 深度笔记包含三个层次分析
- ✅ Markdown文件格式正确
- ✅ 中文文件名处理正确

## 🔧 技术细节

### 关键改进
1. **简化接口**：移除了 `concise` 和 `bullet-points` 选项
2. **强化提示词**：专门针对中文深度笔记优化
3. **增加Token**：从2000提升到10000，确保质量
4. **智能分段**：使用timeline-helper进行内容分析
5. **UTF-8支持**：完整的中文字符支持

### 向后兼容性
- 所有现有API调用继续工作
- JSON结构向后兼容
- 新增字段 (`timeline`, `deepNotes`) 为可选

## 🎯 最佳实践

### 输入建议
- 视频时长：5-60分钟效果最佳
- 内容类型：演讲、教程、访谈等结构化内容
- 音质要求：清晰的音频有助于更好的转录

### 输出优化
- 检查生成的时间轴是否合理
- 验证深度笔记的三层结构
- 确认中文表达的准确性和流畅性

## 📞 问题排查

### 常见问题
1. **API密钥错误**：确保 `OPENAI_API_KEY` 设置正确
2. **超时错误**：视频太长可能导致处理超时
3. **编码问题**：确保系统支持UTF-8编码

### 调试方法
1. 使用 `test-prompt.js` 验证基础功能
2. 检查 `test-output/` 目录的输出文件
3. 查看控制台日志了解处理进度